extends ../layout
block content
    if errors
      each error in errors
        p= error.message
    h1= book.title
    |     
    form(method="post")
      p
        label(for='title') Title
        input#title(type='text', name='title' value= book.title )
      |         
      p
        label(for='author') Author
        input#author(type='text', name='author' value= book.author)
      |         
      p
        label(for='genre') Genre
        input#genre(type='text', name='genre' value= book.genre)
      |         
      p
        label(for='first_published') First Published
        input#first_published(type='text', name='first_published' value= book.first_published)
      |         
      p
        input(type='submit', value='Update')
    |     
    h2 Loan History
    |     
    table
      thead
        tr
          th Book
          |                 
          th Patron 
          |                 
          th Loaned on
          |                 
          th Return by 
          |                 
          th Returned on
          |                 
          th Action
      |         
      tbody
        if book.Loan
            tr
              td
                a(href='/books/book_detail/'+book.Loan.book_id)= book.title
              |                 
              td
                a(href='/patrons/patron_detail/'+book.Loan.patron_id)= book.Loan.Patron.first_name +' '+ book.Loan.Patron.last_name
              |                 
              td= book.Loan.loaned_on.slice(0, 10)
              |                 
              td= book.Loan.return_by.slice(0, 10)
              |
              if book.Loan.returned_on                 
                td= book.Loan.returned_on.slice(0, 10)
                |  
              else
                td
                |                 
              if !book.Loan.returned_on || book.Loan.returned_on < book.Loan.loaned_on                
                td
                  a.button(href=`/loans/return_book/${book.Loan.book_id}/${book.Loan.patron_id}`) Return Book
              else
                td
                |
            |
        else            
          tr
          |